# Tutorial 4: Structure searching with mattersim

## 1. Using Mattersim for structure search

In this search we have 3 elements. Whilst EDDPs can be used for many elements, it can sometimes be beneficial to use large universal potentials for a smaller initial search. Particularly when large numbers of elements are involved.

In this example we will use the mattersim potential developed by microsoft to relax the random structures generated by buildcell.

This simply requires setting the option `-matsim` inÂ [airss.pl](http://airss.pl/):

```console
spawn airss.pl -s <seed> -matsim -mpinp 4
```

Run this command and check to make sure that structures are being generated.

You should notice that structure generation is slow compared to an eddp. This is to be expected as the mattersim potential uses a large model, so calculating energies (i.e. inference through the neural network) is significantly slower. Of course, the trade-off is that we do not need to train a potential from scratch each time.

## 2. Try a structure search on your system !

Try to use Mattersim for structure search on a particular system of your choice. The aim of these tutorials is to help you to get your hands on AIRSS and EDDP so that you can use it for your own research.\
You can try now, your demonstrators will be happy to help you !

## BONUS:


## 3. Molecular Unit Searching


In many cases, we may want to constrain our search to consider molecular units. For example when looking for new phases of water ice, we may want to constrain the search to H20 units, rather than all possible structures with a 2:1, H:O stoichiometry.

To search with molecular units in airss we can make some simple changes to our `.cell` file.
```console
%BLOCK POSITIONS_ABS\
H       2.24086   1.13513   0.61201 # H2O % NUM=0-20\
H       2.15713   1.06943  -0.56863 # H2O\
O       1.51517   1.94706   1.50220 # H2O\
%ENDBLOCK POSITIONS_ABS\
```
There are several changes to note here. First of all we change to absolute atomic positions with %BLOCK POSITIONS_ABS, as opposed to the fractional positions tag %BLOCK POSTIONS_FRAC we have used previously.

Secondly we now have a tag after each line, # H2O, in this case. All atoms with the same tag will be treated as the same molecular unit.

Finally, we specify the number of these units by placing a % NUM=X-Y after one of the lines with the H2O tag. X and Y can set a range which will be randomly selected, or a single number.

Once we have set our molecular units we can use the #UNTIE command.

## 4. Distillation of a mattersim potential - (optional and to be continued at home!)


Universal potentials sit somewhere between DFT and EDDPs in terms of speed.

The final exercise will be 'distillation' of a potential from mattersim generated data.

The general idea here is to rapidly train a potential that is a few orders of magnitude faster than a universal potential, so that we can scale up our searches and molecular dynamics (without having to use a GPU).

Step one of this exercise is to install the eddp suite on your laptop.

clone all bitbucket repositories to your laptop and follow the readme to install.

If you are using a windows laptop try referring to the guide during the installation party.
